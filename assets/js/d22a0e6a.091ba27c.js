"use strict";(self.webpackChunkactix_website=self.webpackChunkactix_website||[]).push([[7586],{8863:function(e,t,a){a.r(t),a.d(t,{assets:function(){return m},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return p},metadata:function(){return c},toc:function(){return d}});var s=a(7462),n=a(3366),o=(a(7294),a(3905)),i=a(2536),r=["components"],p={title:"Databases"},l="Async Options",c={unversionedId:"databases",id:"databases",title:"Databases",description:"We have several example projects showing use of async database adapters:",source:"@site/docs/databases.md",sourceDirName:".",slug:"/databases",permalink:"/actix-website/docs/databases",draft:!1,editUrl:"https://github.com/actix/actix-website/edit/master/docs/databases.md",tags:[],version:"current",frontMatter:{title:"Databases"},sidebar:"docs",previous:{title:"Auto-Reloading",permalink:"/actix-website/docs/autoreload"},next:{title:"HTTP Server Initialization",permalink:"/actix-website/docs/http_server_init"}},m={},d=[],u={toc:d};function h(e){var t=e.components,a=(0,n.Z)(e,r);return(0,o.kt)("wrapper",(0,s.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"async-options"},"Async Options"),(0,o.kt)("p",null,"We have several example projects showing use of async database adapters:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Postgres: ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/actix/examples/tree/master/databases/postgres"},"https://github.com/actix/examples/tree/master/databases/postgres")),(0,o.kt)("li",{parentName:"ul"},"SQLite: ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/actix/examples/tree/master/databases/sqlite"},"https://github.com/actix/examples/tree/master/databases/sqlite")),(0,o.kt)("li",{parentName:"ul"},"MongoDB: ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/actix/examples/tree/master/databases/mongodb"},"https://github.com/actix/examples/tree/master/databases/mongodb"))),(0,o.kt)("h1",{id:"diesel"},"Diesel"),(0,o.kt)("p",null,"The current version of Diesel (v1) does not support asynchronous operations, so it is important to use the ",(0,o.kt)("a",{parentName:"p",href:"https://docs.rs/actix-web/4/actix_web/web/fn.block.html"},(0,o.kt)("inlineCode",{parentName:"a"},"web::block"))," function to offload your database operations to the Actix runtime thread-pool."),(0,o.kt)("p",null,"You can create action functions that correspond to all the operations your app will perform on the database."),(0,o.kt)(i.Z,{example:"databases",file:"main.rs",section:"handler",mdxType:"CodeBlock"}),(0,o.kt)("p",null,"Now you should set up the database pool using a crate such as ",(0,o.kt)("inlineCode",{parentName:"p"},"r2d2"),", which makes many DB connections available to your app. This means that multiple handlers can manipulate the DB at the same time, and still accept new connections. Simply, the pool in your app state. (In this case, it's beneficial not to use a state wrapper struct because the pool handles shared access for you.)"),(0,o.kt)(i.Z,{example:"databases",file:"main.rs",section:"main",mdxType:"CodeBlock"}),(0,o.kt)("p",null,"Now, in a request handler, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"Data<T>")," extractor to get the pool from app state and get a connection from it. This provides an owned database connection that can be passed into a ",(0,o.kt)("a",{parentName:"p",href:"https://docs.rs/actix-web/4/actix_web/web/fn.block.html"},(0,o.kt)("inlineCode",{parentName:"a"},"web::block"))," closure. Then just call the action function with the necessary arguments and ",(0,o.kt)("inlineCode",{parentName:"p"},".await")," the result."),(0,o.kt)("p",null,"This example also maps the error to an ",(0,o.kt)("inlineCode",{parentName:"p"},"HttpResponse")," before using the ",(0,o.kt)("inlineCode",{parentName:"p"},"?")," operator but this is not necessary if your return error type implements ",(0,o.kt)("a",{parentName:"p",href:"https://docs.rs/actix-web/4/actix_web/trait.ResponseError.html"},(0,o.kt)("inlineCode",{parentName:"a"},"ResponseError")),"."),(0,o.kt)(i.Z,{example:"databases",file:"main.rs",section:"index",mdxType:"CodeBlock"}),(0,o.kt)("p",null,"That's it! See the full example here: ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/actix/examples/tree/master/databases/diesel"},"https://github.com/actix/examples/tree/master/databases/diesel")))}h.isMDXComponent=!0}}]);