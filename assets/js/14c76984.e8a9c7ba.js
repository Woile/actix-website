"use strict";(self.webpackChunkactix_website=self.webpackChunkactix_website||[]).push([[8456],{18:function(e,t,a){a.r(t),a.d(t,{assets:function(){return m},contentTitle:function(){return p},default:function(){return h},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return d}});var r=a(7462),n=a(3366),o=(a(7294),a(3905)),i=a(2536),s=["components"],l={title:"Extractors"},p="Type-safe information extraction",c={unversionedId:"extractors",id:"extractors",title:"Extractors",description:"Actix Web provides a facility for type-safe request information access called extractors (i.e., impl FromRequest). There are lots of built-in extractor implementations (see implementors).",source:"@site/docs/extractors.md",sourceDirName:".",slug:"/extractors",permalink:"/actix-website/docs/extractors",draft:!1,editUrl:"https://github.com/actix/actix-website/docs/extractors.md",tags:[],version:"current",frontMatter:{title:"Extractors"},sidebar:"docs",previous:{title:"Server",permalink:"/actix-website/docs/server"},next:{title:"Handlers",permalink:"/actix-website/docs/handlers"}},m={},d=[{value:"Path",id:"path",level:2},{value:"Query",id:"query",level:2},{value:"Json",id:"json",level:2},{value:"Other",id:"other",level:2}],u={toc:d};function h(e){var t=e.components,a=(0,n.Z)(e,s);return(0,o.kt)("wrapper",(0,r.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"type-safe-information-extraction"},"Type-safe information extraction"),(0,o.kt)("p",null,"Actix Web provides a facility for type-safe request information access called ",(0,o.kt)("em",{parentName:"p"},"extractors")," (i.e., ",(0,o.kt)("inlineCode",{parentName:"p"},"impl FromRequest"),"). There are lots of built-in extractor implementations (see ",(0,o.kt)("a",{parentName:"p",href:"https://actix.rs/actix-web/actix_web/trait.FromRequest.html#implementors"},"implementors"),")."),(0,o.kt)("p",null,"An extractor can be accessed as an argument to a handler function. Actix Web supports up to 12 extractors per handler function. Argument position does not matter."),(0,o.kt)(i.Z,{example:"extractors",file:"main.rs",section:"option-one",mdxType:"CodeBlock"}),(0,o.kt)("h2",{id:"path"},"Path"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://docs.rs/actix-web/4/actix_web/dev/struct.Path.html"},(0,o.kt)("em",{parentName:"a"},"Path")),' provides information that is extracted from the request\'s path. Parts of the path that are extractable are called "dynamic segments" and are marked with curly braces. You can deserialize any variable segment from the path.'),(0,o.kt)("p",null,"For instance, for resource that registered for the ",(0,o.kt)("inlineCode",{parentName:"p"},"/users/{user_id}/{friend}")," path, two segments could be deserialized, ",(0,o.kt)("inlineCode",{parentName:"p"},"user_id")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"friend"),". These segments could be extracted as a tuple in the order they are declared (e.g., ",(0,o.kt)("inlineCode",{parentName:"p"},"Path<(u32, String)>"),")."),(0,o.kt)(i.Z,{example:"extractors",file:"path_one.rs",section:"path-one",mdxType:"CodeBlock"}),(0,o.kt)("p",null,"It is also possible to extract path information to a type that implements the ",(0,o.kt)("inlineCode",{parentName:"p"},"Deserialize")," trait from ",(0,o.kt)("inlineCode",{parentName:"p"},"serde")," by matching dynamic segment names with field names. Here is an equivalent example that uses ",(0,o.kt)("inlineCode",{parentName:"p"},"serde")," instead of a tuple type."),(0,o.kt)(i.Z,{example:"extractors",file:"path_two.rs",section:"path-two",mdxType:"CodeBlock"}),(0,o.kt)("p",null,"As a non-type-safe alternative, it's also possible to query (see ",(0,o.kt)("a",{parentName:"p",href:"https://docs.rs/actix-web/latest/actix_web/struct.HttpRequest.html#method.match_info"},(0,o.kt)("inlineCode",{parentName:"a"},"match_info")," docs"),") the request for path parameters by name within a handler:"),(0,o.kt)(i.Z,{example:"extractors",file:"path_three.rs",section:"path-three",mdxType:"CodeBlock"}),(0,o.kt)("h2",{id:"query"},"Query"),(0,o.kt)("p",null,"The ",(0,o.kt)("a",{parentName:"p",href:"https://docs.rs/actix-web/4/actix_web/web/struct.Query.html"},(0,o.kt)("inlineCode",{parentName:"a"},"Query<T>"))," type provides extraction functionality for the request's query parameters. Underneath it uses ",(0,o.kt)("inlineCode",{parentName:"p"},"serde_urlencoded")," crate."),(0,o.kt)(i.Z,{example:"extractors",file:"query.rs",section:"query",mdxType:"CodeBlock"}),(0,o.kt)("h2",{id:"json"},"Json"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://docs.rs/actix-web/4/actix_web/web/struct.Json.html"},(0,o.kt)("inlineCode",{parentName:"a"},"Json<T>"))," allows deserialization of a request body into a struct. To extract typed information from a request's body, the type ",(0,o.kt)("inlineCode",{parentName:"p"},"T")," must implement ",(0,o.kt)("inlineCode",{parentName:"p"},"serde::Deserialize"),"."),(0,o.kt)(i.Z,{example:"extractors",file:"json_one.rs",section:"json-one",mdxType:"CodeBlock"}),(0,o.kt)("p",null,"Some extractors provide a way to configure the extraction process. To configure an extractor, pass its configuration object to the resource's ",(0,o.kt)("inlineCode",{parentName:"p"},".app_data()")," method. In the case of ",(0,o.kt)("em",{parentName:"p"},"Json")," extractor it returns a ",(0,o.kt)("a",{parentName:"p",href:"https://docs.rs/actix-web/4/actix_web/web/struct.JsonConfig.html"},(0,o.kt)("em",{parentName:"a"},"JsonConfig")),". You can configure the maximum size of the JSON payload as well as a custom error handler function."),(0,o.kt)("p",null,"The following example limits the size of the payload to 4kb and uses a custom error handler."),(0,o.kt)(i.Z,{example:"extractors",file:"json_two.rs",section:"json-two",mdxType:"CodeBlock"}),(0,o.kt)("h1",{id:"url-encoded-forms"},"URL-Encoded Forms"),(0,o.kt)("p",null,"A URL-encoded form body can be extracted to a struct, much like ",(0,o.kt)("inlineCode",{parentName:"p"},"Json<T>"),". This type must implement ",(0,o.kt)("inlineCode",{parentName:"p"},"serde::Deserialize"),"."),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://docs.rs/actix-web/4/actix_web/web/struct.FormConfig.html"},(0,o.kt)("em",{parentName:"a"},"FormConfig"))," allows configuring the extraction process."),(0,o.kt)(i.Z,{example:"extractors",file:"form.rs",section:"form",mdxType:"CodeBlock"}),(0,o.kt)("h2",{id:"other"},"Other"),(0,o.kt)("p",null,"Actix Web also provides several other extractors:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.rs/actix-web/4/actix_web/web/struct.Data.html"},(0,o.kt)("em",{parentName:"a"},"Data"))," - If you need access to an application state."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"HttpRequest")," - ",(0,o.kt)("em",{parentName:"li"},"HttpRequest")," itself is an extractor which returns self, in case you need access to the request."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"String")," - You can convert a request's payload to a ",(0,o.kt)("em",{parentName:"li"},"String"),". ",(0,o.kt)("a",{parentName:"li",href:"https://docs.rs/actix-web/4/actix_web/trait.FromRequest.html#impl-FromRequest-for-String"},(0,o.kt)("em",{parentName:"a"},"Example"))," is available in doc strings."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"actix_web::web::Bytes")," - You can convert a request's payload into ",(0,o.kt)("em",{parentName:"li"},"Bytes"),". ",(0,o.kt)("a",{parentName:"li",href:"https://docs.rs/actix-web/4/actix_web/trait.FromRequest.html#impl-FromRequest-5"},(0,o.kt)("em",{parentName:"a"},"Example"))," is available in doc strings."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"Payload")," - Low-level payload extractor primarily for building other extractors. ",(0,o.kt)("a",{parentName:"li",href:"https://docs.rs/actix-web/4/actix_web/web/struct.Payload.html"},(0,o.kt)("em",{parentName:"a"},"Example")))),(0,o.kt)("h1",{id:"application-state-extractor"},"Application State Extractor"),(0,o.kt)("p",null,"Application state is accessible from the handler with the ",(0,o.kt)("inlineCode",{parentName:"p"},"web::Data")," extractor; however, state is accessible as a read-only reference. If you need mutable access to state, it must be implemented."),(0,o.kt)("p",null,"Here is an example of a handler that stores the number of processed requests:"),(0,o.kt)(i.Z,{example:"request-handlers",file:"main.rs",section:"data",mdxType:"CodeBlock"}),(0,o.kt)("p",null,"Although this handler will work, ",(0,o.kt)("inlineCode",{parentName:"p"},"data.count")," will only count the number of requests handled ",(0,o.kt)("em",{parentName:"p"},"by each worker thread"),". To count the number of total requests across all threads, one should use shared ",(0,o.kt)("inlineCode",{parentName:"p"},"Arc")," and ",(0,o.kt)("a",{parentName:"p",href:"https://doc.rust-lang.org/std/sync/atomic/"},"atomics"),"."),(0,o.kt)(i.Z,{example:"request-handlers",file:"handlers_arc.rs",section:"arc",mdxType:"CodeBlock"}),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Note"),": If you want the ",(0,o.kt)("em",{parentName:"p"},"entire")," state to be shared across all threads, use ",(0,o.kt)("inlineCode",{parentName:"p"},"web::Data")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"app_data")," as described in ",(0,o.kt)("a",{parentName:"p",href:"/docs/application#shared-mutable-state"},"Shared Mutable State"),"."),(0,o.kt)("p",null,"Be careful when using blocking synchronization primitives like ",(0,o.kt)("inlineCode",{parentName:"p"},"Mutex")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"RwLock")," within your app state. Actix Web handles requests asynchronously. It is a problem if the ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Critical_section"},(0,o.kt)("em",{parentName:"a"},"critical section"))," in your handler is too big or contains an ",(0,o.kt)("inlineCode",{parentName:"p"},".await")," point. If this is a concern, we would advise you to also read ",(0,o.kt)("a",{parentName:"p",href:"https://tokio.rs/tokio/tutorial/shared-state#on-using-stdsyncmutex"},"Tokio's advice on using blocking ",(0,o.kt)("inlineCode",{parentName:"a"},"Mutex")," in async code"),"."))}h.isMDXComponent=!0}}]);